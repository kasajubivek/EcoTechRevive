{% extends "main/base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
{% load static %}
{% if products %}
<h3 style="text-align:center; color:#3E454C;">{{ title }}</h3>
<br>

<!-- products data start -->
<div class="row">
  {% for p in products %}
  <!-- card1 -->
  <div class="column">
    <div class="container page-wrapper" style="width: 450px;">
      <div class="page-inner">
        <div class="row">
          <div class="el-wrapper">
            <div class="box-up">
              <a href="{% url 'product_detail' p.id %}">
                <img class="img" src="{{ p.product_image.url }}" alt="product pic" height="300px" width="300px">
              </a>
              <div class="img-info">
                <div class="info-inner">
                  <span style="background-color:#3e454c; color:#fbfbfb;" class="p-company">{{ p.name }}</span>
                </div>
                <div class="a-size">{{ p.description|slice:":40" }}{% if p.description|length > 0 %}... <a href="{% url 'product_detail' p.id %}">More Details</a>{% endif %}

                </div>
              </div>
            </div>
            <div class="box-down">
              <div class="h-bg">
                <div class="h-bg-inner"></div>
              </div>
              <a class="cart" href="{% url 'add_to_cart' p.id %}">
                <span class="price">${{ p.price }}</span>
                <span class="add-to-cart">
                  <span class="txt"><i class="fa fa-shopping-cart"></i> Add To Cart</span>
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- card1 end -->
  {% if forloop.counter|divisibleby:"3" %}
</div>
<div class="row">
  {% endif %}
  {% endfor %}
</div>
<!-- products data end -->
    <!-- View Cart Button -->
<div class="container mt-4 text-center">
  <a href="{% url 'cart_detail' %}" class="btn btn-custom"><i class="fa fa-shopping-cart"></i> View Cart</a>
</div>
{% else %}
<h3 style="text-align:center; color:#3E454C;">Oops! There are no products</h3>
{% endif %}

<div id="popup-message" class="popup-message">
  <span id="popup-text"></span>
  <button onclick="closePopup()" class="popup-close-btn">&times;</button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    {% if messages %}
    const popupMessage = document.getElementById("popup-message");
    const popupText = document.getElementById("popup-text");
    {% for message in messages %}
    popupText.innerHTML = "{{ message }}";
    popupMessage.style.display = "block";
    setTimeout(() => { popupMessage.style.display = "none"; }, 3000);
    {% endfor %}
    {% endif %}
  });

  function closePopup() {
    document.getElementById("popup-message").style.display = "none";
  }
</script>

<style>
  .btn-custom {
    background-color: #558755;
    color: white;
    border-color: white;
  }

  .popup-message {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #4CAF50;
    color: white;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    text-align: center;
  }

  .popup-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    line-height: 20px;
    cursor: pointer;
    margin-left: 10px;
  }
</style>
{% endblock %}
